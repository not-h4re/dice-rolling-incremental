<html lang="en">
  <head>
    <title>dice rolling incremental</title>
    
    <!-- stylesheet import -->
    <link rel="stylesheet" href="style.css">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Victor+Mono:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="js/main.js" defer></script>
    <script src="js/save.js" ></script>
    <script src="https://cdn.jsdelivr.net/npm/break_eternity.js@2.1.0/dist/break_eternity.min.js"></script>
    <script src="js/customFormat.js" defer></script>
    <script src="libs/notify.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <div id="app">
      
      <!-- POINT DISPLAY -->
      You have <h2 class="glow p">{{f(player.points)}}</h2> points<br><br>
      
      <!-- TABS -->
      <button class="tab" onclick="player.tab='main'">
        Main
      </button>
      <button v-if="player.unl.gambling" class="tab" onclick="tab('gambling', player.prevtab.gambling)">
        Gambling
      </button>
      <button v-if="player.unl.sacrifice" class="tab" onclick="player.tab='sacrifice'">
        Sacrifice
      </button>
      <button class="tab" onclick="player.tab='opt'">
        Options
      </button><br><br>
      
      <!-- MAIN GAME-->
      <div v-if="player.tab=='main'">
        <!--
        this is testing
        <span v-for="n in 10" :key="n">
          {{n}}
        </span>
        -->
        <span style="font-size:18px !important;">
          Your dice has {{f(player.maxroll.sub(player.minroll).add(1))}} sides<br>
          (Range: {{f(player.minroll)}} - {{f(player.maxroll)}})<br>
          Point gain is x{{f(pointMul())}} of dice roll<br>
          Upgrade n is autobought for free when upgrade n+4 is owned!<br>
        </span>
        <button class="upg rollbtn" onclick="roll()">
          Roll the dice<br>
          Last roll: {{f(player.result)}}
        </button>
        <br><br>
        <span class="opt upgs">
          <button :class="{upg: true, can: canAfford(n)}" @click="buyupg(n)" v-if="upgs[n].unlocked()" v-for="n in 5">
            ({{f(player.upgs[n], 0)}}/{{f(upgs[n].cap(), 0)}})<br>
            {{upgs[n].description()}}<br>
            Currently: {{upgs[n].effDis()}}<br>
            {{player.upgs[n].gte(upgs[n].cap())?"Maxed!":("Cost: "+f(upgs[n].cost())+" "+upgs[n].curr)}}
          </button>
        </span>
        <span class="opt upgs">
          <button v-for="n in 4" :class="{upg: true, can: canAfford(n+5)}" @click="buyupg(n+5)" v-if="upgs[n+5].unlocked()">
            ({{f(player.upgs[n+5], 0)}}/{{f(upgs[n+5].cap(), 0)}})<br>
            {{upgs[n+5].description()}}<br>
            Currently: {{upgs[n+5].effDis()}}<br>
            {{player.upgs[n+5].gte(upgs[n+5].cap())?"Maxed!":("Cost: "+f(upgs[n+5].cost())+" "+upgs[n+5].curr)}}
          </button>
        </span>
      </div>
      
      <!-- GAMBLING :$ -->
      <div v-if="checkTab('gambling')">
        <button class="tab" onclick="tab('gambling', 'main')">
          Main
        </button>
        <button class="tab" onclick="tab('gambling', 'luck')" v-if="miles[7].isOwned()">
          Luck
        </button>
        <button class="tab" onclick="tab('gambling', 'pluck')" v-if="miles[12].isOwned()">
          Prestige Luck
        </button>
      </div>

      <div v-if="checkTab('gambling', 'main')">
        Your gambling level is <h2 class="glow gl">{{format(player.gamblinglevel, 0)}}</h2><br><br>
        
        Reset all base features (points, point upgrades) to increase your gambling level by 1<br>
        Your gambling level multiplies point gain by {{format(gamblingLevelToPointMulti())}}<br>
        It also autobuys the first {{formatWhole(autoboughtUpgradesFromGamblingLevel())}} point upgrades<br>
        There are also milestones associated with gambling level<br><br>
        
        <button :class="{reset: true, can: canIncreaseGamblingLevel()}" onclick="increaseGamblingLevel()">
          The next gambling level requires {{format(gamblingLevelReq(player.gamblinglevel))}} points<br><br>
          Click this button to reset
        </button>
        
        <div class="milecontainer">
          <span v-for="n in 13">
            <div :class="{milestone: true, got: miles[n].isOwned()}" v-if="miles[Math.max(0, n-4)].isOwned()">
              <h3 class="inline">
                {{miles[n].name}}
              </h3><br>
              {{miles[n].effect}}
            </div>
          </span>
        </div>
      </div>

      <div v-if="checkTab('gambling', 'luck')">
        <span v-if="player.gwaed == true">the gwa is in<br></span>
        You have <span class="glow l">{{format(player.luck.luck, 7)}}</span> luck<br>
        You have <span class="glow l">{{format(player.luck.points)}}</span> luck points, multiplying point gain by <span class="glow l">{{format(getPointBoostFromLuck())}}</span><br>
        Your luck generates {{format(luckPointGen(), 5)}} luck points/second<br>
        You also have <span class="glow l">{{format(player.luck.unluck)}}</span> unluck, dividing gambling level requirement by {{format(unluckEffect())}}<br>
        You gain {{format(unluckGain())}} unluck per roll that did not increase your luck<br>
        Luck formula: log<sub>2</sub>(1/Math.random() * {{format(luckChanceMulti())}}) + 1<br>
        <br>
        <div class="opt upgs">
          <button onclick="luckRoll()" class="rollbtn upg">
            Click to roll<br>
            The last roll had a result of {{format(player.luck.lastroll, 7)}}
          </button>
          <button onclick="player.luck.autoroll = !player.luck.autoroll" class="rollbtn upg" v-if="miles[10].isOwned()">
            Auto roll: {{player.luck.autoroll}}
          </button>
        </div>
        <br><br>
        <div class="opt upgs">
          <button v-for="n in 4" :class="{upg: true, can: canAffordLuckUpg(n)}" @click="buyluckupg(n)" v-if="upgs.luck[n].unlocked && player.gamblinglevel.gte(11)">
            ({{f(player.luck.upgs[n], 0)}})<br>
            {{upgs.luck[n].description()}}<br>
            Currently: {{upgs.luck[n].effDis()}}<br>
            Cost: {{f(upgs.luck[n].cost())}} unluck
          </button>
        </div>
      </div>

      <div v-if="checkTab('gambling', 'pluck')">
        <span v-if="player.gwaed == true">the prestiged gwa is in<br></span>
        Let the inflation begin.<br>
        You have <span class="glow pl">{{f(player.luck.pluck, 7)}}</span><span v-if="player.luck.pluck.gte(100)"> (hardcapped)</span> prestige luck<br>
        Your prestige luck multiplies unluck gain by <span class="glow pl">{{f(pluckEffect())}}</span><br>
        <br>
        Reset the base and luck features, except upgrades, to roll prestige luck<br>
        You need to be gl{{formatWhole(player.luck.pluckinc.add(20))}} or above to reset<br>
        This increases when you get a roll that increases your prestige luck<br>
        Your prestige luck multiplier is <span class="glow pl">x{{f(pluckMult(), 7)}}</span><br>
        (1.15<sup>gl - 20</sup> * 1.12<sup>luck - 10</sup> * (10<sup>-10</sup> + 1.01<sup>log<sub>1.11</sub>((unluck+1)/1e40)</sup>))<br>
        <br>
        <div class="opt upgs">
          <button onclick="prestigeLuckReset()" :class="{reset: true, can: canPluckReset()}">
            Click this button to reset<br>
            Last roll: {{f(player.luck.plastroll)}}
          </button>
          <button class="reset can" onclick="pluckRespec()">
            Reset prestige luck but reset the gambling level requirement; this also does a prestige luck reset and resets luck upgrades
          </button>
        </div>
      </div>

      <!-- i need to go further.. 
       SACRIFICE -->
      <div v-if="player.tab=='sacrifice'">
        Sacrifice everything before this point in exchange for 0 undefined :trol:
      </div>
      
      <!-- OPTIONS -->
      <div v-if="player.tab=='opt'">
        <br>
        <div class="opt">
          <button class="option" onclick="save()">
            Save
          </button>
          <button class="option" onclick="exportSave()">
            Export save
          </button>
          <div>
            <button class="option small" onclick="importSave(document.getElementById('importbox').value)">
              Import below save
            </button><br>
            <input id="importbox" class="optioninput">
          </div>
        </div>
        <div class="opt">
          <button class="option" onclick="hardReset()">
            Reset all progress
          </button>
          <button class="option" onclick="player.offlineprogress = !player.offlineprogress">
            Cap tick length: {{!player.offlineprogress}}
          </button>
          <button class="option" onclick="player.gwaed = false" v-if="player.gwaed">
            Remove the gwa
          </button>
          <!-- 
          TODO make importbox modal
          also make option buttons be 3/row
          -->
        </div>
      </div>
    </div>
  </body>
</html>
